<!DOCTYPE html>
<html>
    <head>
        <title>AR Location Map Demo</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>
    </head>
    <body style="margin: 0; overflow: hidden">
        <a-scene
            embedded
            arjs="sourceType: webcam; debugUIEnabled: false;"
            vr-mode-ui="enabled: false"
            renderer="logarithmicDepthBuffer: true;"
        >
            <!-- AR Camera with GPS -->
            <a-camera
                gps-new-camera="gpsMinDistance: 5"
                rotation-reader
            ></a-camera>

            <!-- Marker/Location Example - Replace with your real coordinates -->
            <a-image
                src="icons/marker.png"
                gps-new-entity-place="latitude: 23.0225; longitude: 72.5714"
                scale="10 10 10"
                look-at="[gps-new-camera]"
                custom-marker
            ></a-image>

            <!-- Place Name Tag -->
            <a-entity
                text="value: City Hall; color: #FFD600; width: 8;"
                gps-new-entity-place="latitude: 23.0225; longitude: 72.5714"
                scale="20 20 20"
                look-at="[gps-new-camera]"
            ></a-entity>

            <!-- Navigation Arrow Example (Static Direction) -->
            <a-entity
                gltf-model="url(assets/arrow.glb)"
                material="color: red"
                gps-new-entity-place="latitude: 23.08485866181749; longitude: 72.57064291583747"
                scale="20 20 20"
                look-at="[gps-new-camera]"
            ></a-entity>

            <!-- Distance label (updates via JS below) -->
            <a-entity
                id="distanceLabel"
                text="value: ; color: #00F; width: 6;"
                gps-new-entity-place="latitude: 23.0225; longitude: 72.5714"
                position="0 30 0"
                look-at="[gps-new-camera]"
            ></a-entity>
        </a-scene>

        <script>
            document.addEventListener(
                "gps-camera-update-position",
                function (e) {
                    // Hardcoded example target location
                    var targetLat = 23.0225;
                    var targetLon = 72.5714;
                    var pos = e.detail.position;
                    var userLat = pos.latitude;
                    var userLon = pos.longitude;
                    // Compute Haversine distance
                    function toRad(x) {
                        return (x * Math.PI) / 180;
                    }
                    var R = 6378137; // Radius of Earth in meters
                    var dLat = toRad(targetLat - userLat);
                    var dLon = toRad(targetLon - userLon);
                    var a =
                        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                        Math.cos(toRad(userLat)) *
                            Math.cos(toRad(targetLat)) *
                            Math.sin(dLon / 2) *
                            Math.sin(dLon / 2);
                    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                    var d = Math.round(R * c);

                    // Update distance label
                    var distanceLabel =
                        document.getElementById("distanceLabel");
                    if (distanceLabel) {
                        distanceLabel.setAttribute(
                            "text",
                            "value",
                            `${d} meters`
                        );
                    }
                }
            );
        </script>
    </body>
</html>
